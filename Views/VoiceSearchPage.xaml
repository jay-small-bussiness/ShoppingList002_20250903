<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ShoppingList002.Views.VoiceSearchPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:ShoppingList002.ViewModels"
    Title="æŽ¢ã—ã¦è¿½åŠ ">

    <ScrollView>
        <!-- â˜… é•·æ–‡ãƒ’ãƒ³ãƒˆã‚‚åŽã¾ã‚‹ã‚ˆã†ã« -->
        <StackLayout Padding="20" Spacing="16">

            <!-- â˜… ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºãƒãƒƒãƒ— -->
            <Border StrokeThickness="0" BackgroundColor="#EEF2FF" Padding="8" StrokeShape="RoundRectangle 12">
                <Label Text="{Binding ModeChipText}" FontSize="12" TextColor="#3730A3"/>
            </Border>

            <!-- â˜… å¿œç­”å½¢å¼ï¼ˆãƒ”ãƒ³ãƒãƒ³/èª¬æ˜Žåž‹ï¼‰ã‚¹ã‚¤ãƒƒãƒ -->
            <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                <Label Text="å¿œç­”å½¢å¼" VerticalOptions="Center"/>
                <Picker WidthRequest="220"
                    ItemsSource="{Binding VoiceModeOptions}"
                    SelectedIndex="{Binding SelectedVoiceModeIndex}" />
            </HorizontalStackLayout>

            <!-- â˜… ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ & ãƒ’ãƒ³ãƒˆ -->
            <Label Text="{Binding PromptText}" FontAttributes="Bold" FontSize="18" />
            <Label Text="{Binding HintText}" FontSize="12" TextColor="#6B7280" />

            <!-- ðŸŽ™ ãƒžã‚¤ã‚¯çŠ¶æ…‹ï¼†ç›´è¿‘ã®èªè­˜ãƒ†ã‚­ã‚¹ãƒˆ -->
            <Grid HeightRequest="120" BackgroundColor="{Binding MicStatusColor}">
                <Label Text="{Binding MicStatusText}"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   FontAttributes="Bold"
                   FontSize="16"/>
                <Label Text="{Binding RecognizedText}"
                   FontSize="18"
                   VerticalOptions="Center"
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center" />
                <!-- â˜… è´å–ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ï¼ˆVMã®IsListeningã«ãƒã‚¤ãƒ³ãƒ‰ï¼‰ -->
                <ActivityIndicator IsRunning="{Binding IsListening}"
                               IsVisible="{Binding IsListening}"
                               Color="White"
                               HorizontalOptions="End" VerticalOptions="End"
                               Margin="8"/>
            </Grid>

            <!-- ðŸ“‹ æ¤œç´¢çµæžœãƒªã‚¹ãƒˆï¼ˆè¤‡æ•°ãƒ’ãƒƒãƒˆæ™‚ï¼‰ -->
            <CollectionView ItemsSource="{Binding SearchResults}"
                        SelectionMode="Single">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BorderColor="Gray" Padding="10" Margin="5"
                           BackgroundColor="{Binding BackgroundColor}"
                           InputTransparent="False">
                            <Frame.GestureRecognizers>
                                <!-- æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ãƒ“ãƒã‚¤ãƒ³ãƒ‰ã‚’æ´»ã‹ã™ -->
                                <TapGestureRecognizer Tapped="OnItemTapped" />
                            </Frame.GestureRecognizers>
                            <VerticalStackLayout>
                                <Label Text="{Binding ItemName}" FontAttributes="Bold" FontSize="16" />
                                <HorizontalStackLayout>
                                    <Label Text="{Binding CategoryName}" FontSize="14" />
                                    <Label Text="{Binding Itemcd}" FontSize="4" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ðŸ§¾ è¿½åŠ å±¥æ­´ -->
            <Label Text="æœ€è¿‘è¿½åŠ ã—ãŸé …ç›®" FontAttributes="Bold" />
            <CollectionView ItemsSource="{Binding AddedHistory}" HeightRequest="150">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Label Text="{Binding}" FontSize="14" />
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- ðŸ”˜ æ“ä½œãƒœã‚¿ãƒ³ï¼ˆâ˜…ãƒ€ãƒŸãƒ¼å’æ¥­ï¼šVMã‚³ãƒžãƒ³ãƒ‰ã«æŽ¥ç¶šï¼‰ -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="12">
                <Button Text="ðŸŽ¤ è´ã"    Command="{Binding StartListeningCommand}" />
                <Button Text="â¹ åœæ­¢"    Command="{Binding StopListeningCommand}" />
                <Button Text="ðŸ”„ å†æ¤œç´¢"  Command="{Binding RetryCommand}" />
                <Button Text="ðŸ”š çµ‚äº†"    Command="{Binding CloseCommand}" />
            </HorizontalStackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>
